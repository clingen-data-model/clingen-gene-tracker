"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[286],{1802:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(5627),r=n.n(s),l=n(6798),i=n.n(l)()(r());i.push([e.id,"li.selected{font-weight:700;text-decoration:underline}","",{version:3,sources:["webpack://./resources/assets/js/components/Curations/BulkLookup/FilterControl.vue"],names:[],mappings:"AAuCA,YAEA,eAAA,CADA,yBAEA",sourcesContent:['<template>\n    <div class="mb-3">\n        <h6>{{title}}</h6>\n        <ul class="list-group text-small">\n            <li class="list-group-item cursor-pointer"\n                v-for="item in items" :key="item"\n                @click="$emit(\'toggle\', item)"\n                :class="{selected: selectedFilters.includes(item)}"\n            >\n                <span class="btn btn-sm float-right cursor-pointer" \n                    v-if="selectedFilters.includes(item)"\n                >\n                    x\n                </span>\n                {{item}}\n            </li>\n        </ul>\n    </div>\n    \n</template>\n<script>\n    export default {\n        props: {\n            items: {\n                type: Array,\n                required: true\n            },\n            title: {\n                type: String,\n                default: \'Filter\'\n            },\n            selectedFilters: {\n                type: Array,\n                required: true\n            }\n        },\n    }\n<\/script>\n<style>\n    li.selected {\n        text-decoration: underline;\n        font-weight: bold;\n    }\n</style>'],sourceRoot:""}]);const o=i},800:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(5627),r=n.n(s),l=n(6798),i=n.n(l)()(r());i.push([e.id,".phenotype[data-v-30505e96]{color:#666;margin-bottom:.5rem}.phenotype.curated[data-v-30505e96]{color:#000}.phenotypes-table[data-v-30505e96]{table-layout:fixed;width:100%}.phenotypes-table th[data-v-30505e96]{width:calc(50% - 3rem)}.phenotypes-table th[data-v-30505e96]:first-child{width:6rem}","",{version:3,sources:["webpack://./resources/assets/js/components/GeneBulkLookup.vue"],names:[],mappings:"AACA,4BACA,UAAA,CACA,mBACA,CACA,oCACA,UACA,CACA,mCAEA,kBAAA,CADA,UAEA,CACA,sCACA,sBACA,CACA,kDACA,UACA",sourcesContent:['<style scoped>\n    .phenotype {\n        color: #666;\n        margin-bottom: .5rem;\n    }\n    .phenotype.curated {\n        color: #000;\n    }\n    .phenotypes-table {\n        width: 100%;\n        table-layout: fixed;\n    }\n    .phenotypes-table th {\n        width: calc(50% - 3rem);\n    }\n    .phenotypes-table th:first-child {\n        width: 6rem;\n    }\n</style>\n<template>\n    <div class="card">\n        <div class="card-header">\n            <h3 class="mb-0">Bulk Gene/Phenotype Lookup</h3>\n        </div>\n        <div class="card-body">\n            <p class="text-grey">\n                Look OMIM phenotypes for genes by gene symbol.\n            </p>\n            <div class="alert alert-danger" v-if="formErrors.length > 0">\n                <ul class="mb-0">\n                    <li v-for="(msg, idx) in formErrors" :key="idx">{{msg}}</li>\n                </ul>\n            </div>\n\n            <lookup-form \n                v-model="geneSymbols"\n                @lookup="search" \n                @getCsv="downloadCsv"\n                class="mb-3"\n            ></lookup-form>\n\n\n            <div v-if="results.length > 0">\n                <h5>Curations:</h5>\n                <b-table \n                    :fields="fields" \n                    :items="filteredResults"\n                    primary-key="id"\n                    bordered\n                    show-empty\n                    :empty-text="emptyText"\n                    :busy="loadingResults"\n                    :small="true"\n                    class="text-small"\n                    striped\n                >\n                    <div slot="table-busy" class="text-center">\n                        Looking for curations...\n                    </div>\n                    <template v-slot:cell(phenotypes)="{value}">\n                        <strong v-if="value.length == 0" class="mb-3 d-block">\n                            No OMIM phenotypes were found for this gene.\n                        </strong>\n                        <table class="table phenotypes-table w-100" v-else>\n                            <thead>\n                                <tr>\n                                    <th width="10%">OMIM ID</th>\n                                    <th width="45%">Name</th>\n                                    <th>MOI</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr v-for="(ph, idx) in value" :key="idx">\n                                    <td>{{ph.mim_number}}</td>\n                                    <td>{{ph.name}}</td>\n                                    <td>{{ph.moi}}</td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </template>\n                </b-table>\n            </div>\n        </div>\n    </div>\n</template>\n<script>\nimport moment from \'moment\';\nimport LookupForm from \'./Curations/BulkLookup/LookupForm.vue\'\nimport FilterControl from \'./Curations/BulkLookup/FilterControl.vue\'\n\nexport default {\n    components: {\n        LookupForm,\n        FilterControl,\n    },\n    props: {\n        \n    },\n    data() {\n        return {\n            geneSymbols: [],\n            results: [],\n            fields: [\n                {\n                    key: \'gene_symbol\',\n                    label: \'Gene\',\n                    sortable: true\n                },\n                {\n                    key: \'phenotypes\',\n                    label: \'Phenotypes\',\n                    sortable: false\n                }\n                \n            ],\n            loadingResults: false,\n            filters: {\n                gene: [],\n                // expertPanel: [],\n                // classification: [],\n                // status: []\n            },\n            formErrors: []\n        }\n    },\n    computed: {\n        emptyText: function () {\n            return \'Add comma speparated gene symbols in the textarea to do a bulk lookup\';\n        },\n        responseGenes: function () {\n            return [...new Set(this.results.map(curation => curation.gene_symbol))];\n        },\n        filteredResults: function () {\n            let results = JSON.parse(JSON.stringify(this.results));\n            // if (this.filters.gene.length > 0) {\n            //     results = results.filter(item => this.filters.gene.indexOf(item.gene_symbol) > -1)\n            // }\n            // if (this.filters.expertPanel.length > 0) {\n            //     results = results.filter(item => this.filters.expertPanel.indexOf(item.expert_panel) > -1)\n            // }\n            // if (this.filters.classification.length > 0) {\n            //     results = results.filter(item => item.current_classification !== null && this.filters.classification.indexOf(item.current_classification.name) > -1)\n            // }\n            // if (this.filters.status.length > 0) {\n            //     results = results.filter(item => item.current_status !== null && this.filters.status.indexOf(item.current_status.name) > -1)\n            // }\n            return results\n        },\n        resultsPanels: function () {\n            if (this.results.length == 0)  {\n                return [];\n            }\n            const items = this.results\n                .filter(curation => curation.expert_panel !== null)\n                .map(curation => {\n                    return curation.expert_panel.name\n                });\n\n            return [...new Set(items)]\n        },\n        resultsClassifications: function () {\n            if (this.results.length == 0)  {\n                return [];\n            }\n            const items = this.results\n                .filter(curation => curation.current_classification !== null)\n                .map(curation => {\n                    return curation.current_classification.name\n                });\n                \n            return [...new Set(items)]\n        },\n        resultsStatuses: function () {\n            if (this.results.length == 0)  {\n                return [];\n            }\n            const items = this.results\n                .filter(curation => curation.current_status !== null)\n                .map(curation => {\n                    return curation.current_status ? curation.current_status.name : null\n                });\n                \n            return [...new Set(items)]\n        }\n    },\n    methods: {\n        search() {\n            this.formErrors = [];\n            this.loadingResults = true;\n            axios.post(\'/api/genes\', {\n                where: {gene_symbol: this.geneSymbols.split(/[, \\n]/)}, \n                with: [\n                    \'phenotypes\', \n                    // \'curations\', \n                    // \'curations.currentStatus\',\n                    // \'curations.expertPanel\', \n                    // \'curations.classifications\'\n                ]\n            })\n                .then(response => {\n                    console.info(\'response\',response)\n                    this.results = response.data\n                    console.info(\'this.results\',this.results)\n                    return response;\n                })\n                .catch(error => {\n                    const flattenedErrors = Object.values(error.response.data.errors).flat();\n                    console.log(flattenedErrors);\n                    this.formErrors = flattenedErrors;\n                })\n                .then(response => {\n                    this.loadingResults = false;\n                });\n        },\n        addFilter(key, value) {\n            if (Object.keys(this.filters).indexOf(key) == -1) {\n                alert(\'Bad filter key. Valid filter keys include: "gene", "expertPanel", "classification", and "status"\');\n                return;\n            }\n            this.filters[key].push(value);\n        },\n        removeFilter(key, value) {\n            const idx = this.filters[key].indexOf(value);\n            if (idx == -1) {\n                return;\n            }\n            const list = JSON.parse(JSON.stringify(this.filters[key]));\n            list.splice(idx, 1);\n            console.log(list);\n            this.$set(this.filters, key, list);\n        },\n        toggleFilter(key, value) {\n            if (this.filters[key].indexOf(value) < 0) {\n                this.addFilter(key, value);\n            } else {\n                this.removeFilter(key, value);\n            }\n        },\n        downloadCsv() {\n            this.search();\n            axios.post(\'/api/genes/csv\', {\n                where: {gene_symbol: this.geneSymbols.split(/[, \\n]/)}, \n                with: [\n                    \'phenotypes\', \n                    // \'curations\', \n                    // \'curations.currentStatus\',\n                    // \'curations.expertPanel\', \n                    // \'curations.classifications\'\n                ]                \n            })\n                .then(response => {\n                    const a = document.createElement(\'a\');\n                    a.style.display = "none";\n                    document.body.appendChild(a);\n\n                    console.log(response.data);\n\n                    a.href = window.URL.createObjectURL( new Blob([response.data, { type: \'text/csv\' }]));\n\n                    a.setAttribute(\'download\', \'bulk-gene-lookup-results.csv\');\n                    a.click();\n\n                    document.body.removeChild(a);\n                })\n                .catch(error => {\n                    const flattenedErrors = Object.values(error.response.data.errors).flat();\n                    console.log(flattenedErrors);\n                    this.formErrors = flattenedErrors;\n                })\n        },\n        phenotypeIsInCuration (ph, curation) {\n            return curation.phenotypes.map(i => i.mim_number).indexOf(ph.mim_number) > -1;\n        }\n    }\n}\n<\/script>'],sourceRoot:""}]);const o=i},6341:(e,t,n)=>{n.d(t,{A:()=>a});const s={props:{items:{type:Array,required:!0},title:{type:String,default:"Filter"},selectedFilters:{type:Array,required:!0}}};var r=n(5072),l=n.n(r),i=n(1802),o={insert:"head",singleton:!1};l()(i.A,o);i.A.locals;const a=(0,n(4486).A)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mb-3"},[n("h6",[e._v(e._s(e.title))]),e._v(" "),n("ul",{staticClass:"list-group text-small"},e._l(e.items,(function(t){return n("li",{key:t,staticClass:"list-group-item cursor-pointer",class:{selected:e.selectedFilters.includes(t)},on:{click:function(n){return e.$emit("toggle",t)}}},[e.selectedFilters.includes(t)?n("span",{staticClass:"btn btn-sm float-right cursor-pointer"},[e._v("\n                x\n            ")]):e._e(),e._v("\n            "+e._s(t)+"\n        ")])})),0)])}),[],!1,null,null,null).exports},575:(e,t,n)=>{n.d(t,{A:()=>r});const s={props:["value","errors"],components:{ValidationError:n(7994).A},data:function(){return{currentTab:0,hasHeader:!1}},computed:{numericCurrentTab:{get:function(){return parseInt(this.currentTab)},set:function(e){this.currentTab=e}}},watch:{currentTab:function(e,t){localStorage.setItem("bulk-upload-form-tab-index",e)}},methods:{processFile:function(e){var t=this;if(console.log(e),"text/csv"!==e[0].type)return alert("The file must be a csv."),void(this.$refs.fileInput.value=null);if(e.length>0&&"text/csv"==e[0].type){var n=new FileReader;n.addEventListener("load",(function(e){var n=e.target.result;if(t.hasHeader){var s=n.split("\n");s.splice(0,1);t.$emit("input",s.join(","))}else t.$emit("input",n)})),n.addEventListener("progress",(function(e){if(e.loaded&&e.total){var t=e.loaded/e.total*100;console.log("progress: ".concat(Math.round(t)))}})),n.readAsText(e[0])}}},mounted:function(){var e=localStorage.getItem("bulk-upload-form-tab-index");this.currentTab=e||0}};const r=(0,n(4486).A)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-tabs",{staticClass:"border",attrs:{vertical:"",pills:"",card:""},model:{value:e.numericCurrentTab,callback:function(t){e.numericCurrentTab=t},expression:"numericCurrentTab"}},[n("b-tab",{attrs:{title:"Manual entry"}},[n("label",{attrs:{for:"gene-symbol-input"}},[e._v("Gene Symbols:")]),e._v("\n            Â \n            "),n("textarea",{staticClass:"form-control",attrs:{cols:"10",rows:"3",id:"gene-symbol-input",maxlength:"1900",placeholder:"Comma, space, or new-line separated gene symboels, i.e.: BCRA1, TP53 ABSC"},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)}}}),e._v(" "),n("div",{staticClass:"mt-1"},[n("button",{staticClass:"btn btn-sm btn-light border",on:{click:function(t){return e.$emit("input","")}}},[e._v("Clear")]),e._v(" "),n("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.$emit("lookup")}}},[e._v("Search")]),e._v(" "),n("button",{staticClass:"btn btn-primary btn-sm float-right",on:{click:function(t){return e.$emit("getCsv")}}},[e._v("Get CSV")])])]),e._v(" "),n("b-tab",{attrs:{title:"CSV Upload"}},[n("div",[n("label",{attrs:{for:"csv-upload"}},[e._v("CSV file: ")]),e._v(" "),n("input",{ref:"fileInput",staticClass:"d-block",attrs:{type:"file",accept:"csv",id:"csv-upload"},on:{change:function(t){return e.processFile(t.target.files)}}}),e._v(" "),n("div",{staticClass:"text-info text-small"},[n("small",[e._v("File should contain a single column with gene symbols.")])]),e._v(" "),n("div",{staticClass:"form-check my-2"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.hasHeader,expression:"hasHeader"}],staticClass:"form-check-input",attrs:{type:"checkbox",id:"has-header"},domProps:{checked:Array.isArray(e.hasHeader)?e._i(e.hasHeader,null)>-1:e.hasHeader},on:{change:function(t){var n=e.hasHeader,s=t.target,r=!!s.checked;if(Array.isArray(n)){var l=e._i(n,null);s.checked?l<0&&(e.hasHeader=n.concat([null])):l>-1&&(e.hasHeader=n.slice(0,l).concat(n.slice(l+1)))}else e.hasHeader=r}}}),e._v(" "),n("label",{staticClass:"form-check-label",attrs:{for:"has-header"}},[e._v(" has header row")])])]),e._v(" "),n("div",{staticClass:"mt-2"},[n("button",{staticClass:"btn btn-primary btn-sm",on:{click:function(t){return e.$emit("lookup")}}},[e._v("Search")]),e._v(" "),n("button",{staticClass:"btn btn-primary btn-sm float-right",on:{click:function(t){return e.$emit("getCsv")}}},[e._v("Get CSV")])])])],1)],1)}),[],!1,null,null,null).exports},7118:(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});n(5093);var s=n(575),r=n(6341);function l(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}const o={components:{LookupForm:s.A,FilterControl:r.A},props:{},data:function(){return{geneSymbols:[],results:[],fields:[{key:"gene_symbol",label:"Gene",sortable:!0},{key:"phenotypes",label:"Phenotypes",sortable:!1}],loadingResults:!1,filters:{gene:[]},formErrors:[]}},computed:{emptyText:function(){return"Add comma speparated gene symbols in the textarea to do a bulk lookup"},responseGenes:function(){return l(new Set(this.results.map((function(e){return e.gene_symbol}))))},filteredResults:function(){return JSON.parse(JSON.stringify(this.results))},resultsPanels:function(){if(0==this.results.length)return[];var e=this.results.filter((function(e){return null!==e.expert_panel})).map((function(e){return e.expert_panel.name}));return l(new Set(e))},resultsClassifications:function(){if(0==this.results.length)return[];var e=this.results.filter((function(e){return null!==e.current_classification})).map((function(e){return e.current_classification.name}));return l(new Set(e))},resultsStatuses:function(){if(0==this.results.length)return[];var e=this.results.filter((function(e){return null!==e.current_status})).map((function(e){return e.current_status?e.current_status.name:null}));return l(new Set(e))}},methods:{search:function(){var e=this;this.formErrors=[],this.loadingResults=!0,axios.post("/api/genes",{where:{gene_symbol:this.geneSymbols.split(/[, \n]/)},with:["phenotypes"]}).then((function(t){return console.info("response",t),e.results=t.data,console.info("this.results",e.results),t})).catch((function(t){var n=Object.values(t.response.data.errors).flat();console.log(n),e.formErrors=n})).then((function(t){e.loadingResults=!1}))},addFilter:function(e,t){-1!=Object.keys(this.filters).indexOf(e)?this.filters[e].push(t):alert('Bad filter key. Valid filter keys include: "gene", "expertPanel", "classification", and "status"')},removeFilter:function(e,t){var n=this.filters[e].indexOf(t);if(-1!=n){var s=JSON.parse(JSON.stringify(this.filters[e]));s.splice(n,1),console.log(s),this.$set(this.filters,e,s)}},toggleFilter:function(e,t){this.filters[e].indexOf(t)<0?this.addFilter(e,t):this.removeFilter(e,t)},downloadCsv:function(){var e=this;this.search(),axios.post("/api/genes/csv",{where:{gene_symbol:this.geneSymbols.split(/[, \n]/)},with:["phenotypes"]}).then((function(e){var t=document.createElement("a");t.style.display="none",document.body.appendChild(t),console.log(e.data),t.href=window.URL.createObjectURL(new Blob([e.data,{type:"text/csv"}])),t.setAttribute("download","bulk-gene-lookup-results.csv"),t.click(),document.body.removeChild(t)})).catch((function(t){var n=Object.values(t.response.data.errors).flat();console.log(n),e.formErrors=n}))},phenotypeIsInCuration:function(e,t){return t.phenotypes.map((function(e){return e.mim_number})).indexOf(e.mim_number)>-1}}};var a=n(5072),u=n.n(a),c=n(800),d={insert:"head",singleton:!1};u()(c.A,d);c.A.locals;const p=(0,n(4486).A)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card"},[e._m(0),e._v(" "),n("div",{staticClass:"card-body"},[n("p",{staticClass:"text-grey"},[e._v("\n            Look OMIM phenotypes for genes by gene symbol.\n        ")]),e._v(" "),e.formErrors.length>0?n("div",{staticClass:"alert alert-danger"},[n("ul",{staticClass:"mb-0"},e._l(e.formErrors,(function(t,s){return n("li",{key:s},[e._v(e._s(t))])})),0)]):e._e(),e._v(" "),n("lookup-form",{staticClass:"mb-3",on:{lookup:e.search,getCsv:e.downloadCsv},model:{value:e.geneSymbols,callback:function(t){e.geneSymbols=t},expression:"geneSymbols"}}),e._v(" "),e.results.length>0?n("div",[n("h5",[e._v("Curations:")]),e._v(" "),n("b-table",{staticClass:"text-small",attrs:{fields:e.fields,items:e.filteredResults,"primary-key":"id",bordered:"","show-empty":"","empty-text":e.emptyText,busy:e.loadingResults,small:!0,striped:""},scopedSlots:e._u([{key:"cell(phenotypes)",fn:function(t){var s=t.value;return[0==s.length?n("strong",{staticClass:"mb-3 d-block"},[e._v("\n                        No OMIM phenotypes were found for this gene.\n                    ")]):n("table",{staticClass:"table phenotypes-table w-100"},[n("thead",[n("tr",[n("th",{attrs:{width:"10%"}},[e._v("OMIM ID")]),e._v(" "),n("th",{attrs:{width:"45%"}},[e._v("Name")]),e._v(" "),n("th",[e._v("MOI")])])]),e._v(" "),n("tbody",e._l(s,(function(t,s){return n("tr",{key:s},[n("td",[e._v(e._s(t.mim_number))]),e._v(" "),n("td",[e._v(e._s(t.name))]),e._v(" "),n("td",[e._v(e._s(t.moi))])])})),0)])]}}],null,!1,488963934)},[n("div",{staticClass:"text-center",attrs:{slot:"table-busy"},slot:"table-busy"},[e._v("\n                    Looking for curations...\n                ")])])],1):e._e()],1)])}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-header"},[n("h3",{staticClass:"mb-0"},[e._v("Bulk Gene/Phenotype Lookup")])])}],!1,null,"30505e96",null).exports},7994:(e,t,n)=>{n.d(t,{A:()=>r});const s={props:["messages"],computed:{hasErrors:function(){return void 0!==this.messages}}};const r=(0,n(4486).A)(s,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.hasErrors,expression:"hasErrors"}],staticClass:"text-danger mt-1"},e._l(e.messages,(function(t,s){return n("div",{key:s},[n("small",[e._v(e._s(t))])])})),0)])}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=GeneBulkLookup.9d044a0a41189b8c.js.map